BEGIN;

DELETE FROM TAT_VIACHANNEL_VISITUSER_TEST
WHERE
    (VC_VISITTIME >= CURRENT_DATE::TIMESTAMP - INTERVAL'7 DAYS'
    AND VC_VISITTIME < CURRENT_DATE::TIMESTAMP)
    OR VC_VISITTIME < CURRENT_DATE - INTERVAL'2 YEARS'
;
INSERT INTO TAT_VIACHANNEL_VISITUSER_TEST
SELECT
    VC_VISITTIME
    ,VC_SENDDT::DATE
    ,VC_CHANNEL
    ,VC_CHANNEL_DETAIL
    ,VC_CAMPAIGNID
    ,VC_DEVICE
    ,VC_OS
    ,VC_EMAILID
    ,VC_OFFERID
    ,VC_FULLVISITORID
    ,VC_TRANSACTIONREVENUE
FROM
	EXTERNAL '/tmp/embulk/cfmdashboard_getvisituser/CFMDashboard_GetVisitUser.csv'
USING (DELIM ',' REMOTESOURCE 'JDBC' LOGDIR '/tmp/embulk/puredata/log'); -- skipRows 1
;

COMMIT;